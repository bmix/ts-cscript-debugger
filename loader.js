"use strict";
// const htmlfile = WScript.CreateObject('htmlfile');
// htmlfile.write('<meta http-equiv="x-ua-compatible" content="IE=9" />');
// // @ts-ignore
// JSON = htmlfile.parentWindow.JSON;
// htmlfile.close();
var fso = new ActiveXObject('Scripting.FileSystemObject');
var collectionToArray = function (col) {
    var results = [];
    var enumerator = new Enumerator(col);
    enumerator.moveFirst();
    while (!enumerator.atEnd()) {
        results.push(enumerator.item());
        enumerator.moveNext();
    }
    return results;
};
var isAbsolutePath = function (s) { return /^[A-Za-z]:/i.test(s); };
var shellExec = function (command, cwd, stream) {
    WScript.Echo("-- Command: " + command);
    WScript.Echo("-- CWD: " + cwd);
    var shell = new ActiveXObject('WScript.Shell');
    if (cwd) {
        shell.CurrentDirectory = cwd;
    }
    var exec = shell.Exec(command);
    while (exec.Status === 0) {
        WScript.Sleep(100);
        while (!exec.StdOut.AtEndOfStream) {
            var nextString = exec.StdOut.ReadAll();
            if (stream) {
                stream.stdout = (stream.stdout || '') + nextString;
            }
            WScript.StdOut.Write(nextString);
        }
    }
};
var args = collectionToArray(WScript.Arguments);
if (args.length === 0) {
    throw new Error('No file to compile and debug');
}
var file = args[0];
if (!isAbsolutePath(file)) {
    file = fso.GetAbsolutePathName(args[0]); // depends on the current working folder being set properly
}
if (!fso.FileExists(file)) {
    throw new Error("Can't find file: " + args[0] + " at location " + file);
}
var tsconfigPath = '';
var parent = file;
do {
    parent = fso.GetParentFolderName(parent);
    var testPath = fso.BuildPath(parent, 'tsconfig.json');
    if (fso.FileExists(testPath)) {
        tsconfigPath = testPath;
    }
} while (!tsconfigPath && parent);
if (!tsconfigPath) {
    throw new Error("Unable to find tsconfig.json for file '" + WScript.ScriptFullName + "'");
}
var outfolderPath = fso.BuildPath(fso.GetParentFolderName(WScript.ScriptFullName), 'out');
if (fso.FolderExists(outfolderPath)) {
    fso.DeleteFolder(outfolderPath, true);
}
try {
    fso.CreateFolder(outfolderPath);
}
catch (_a) {
    WScript.Sleep(100);
    fso.CreateFolder(outfolderPath); // sometimes works on the second attempt
}
var tsconfigFolder = fso.GetParentFolderName(tsconfigPath);
var stream = {};
shellExec('tsc.cmd --noEmit --listFiles', tsconfigFolder, stream);
if (!(stream.stdout)) {
    throw new Error('No emitted files');
}
var scriptFolder = fso.GetParentFolderName(WScript.ScriptFullName);
var outFile = fso.BuildPath(outfolderPath, fso.GetBaseName(file) + '.js');
var files = [
    fso.BuildPath(scriptFolder, 'node_modules\\es5-shim\\es5-shim.js').replace(/\\/g, '\\\\'),
    fso.BuildPath(scriptFolder, 'node_modules\\activex-helpers\\activex-js-helpers.js').replace(/\\/g, '\\\\')
];
for (var _i = 0, _b = stream.stdout.split('\r\n'); _i < _b.length; _i++) {
    var inputFile = _b[_i];
    if (!inputFile) {
        continue;
    }
    if (inputFile.indexOf('/AppData/Roaming/npm/node_modules/typescript/lib/') !== -1) {
        continue;
    }
    files.push(inputFile.replace(/\\/g, '\\\\'));
}
var tsconfig = "{\n    \"compilerOptions\": {\n        \"outFile\": \"" + outFile.replace(/\\/g, '\\\\') + "\",\n        \"listEmittedFiles\": true,\n        \"noEmit\": false,\n        \"module\": \"system\",\n        \"allowJs\": true,\n        \"checkJs\": false,\n        \"inlineSourceMap\": true,\n        \"inlineSources\": true\n    },\n    \"extends\": \"" + tsconfigPath.replace(/\\/g, '\\\\') + "\",\n    \"files\": [\"" + files.join('","') + "\"]\n}";
var txt = fso.CreateTextFile(fso.BuildPath(outfolderPath, 'tsconfig.json'), true, true);
txt.Write(tsconfig);
txt.Close();
txt = undefined;
shellExec("tsc.cmd -p tsconfig.json --outFile \"" + outFile + "\"", outfolderPath);
shellExec("cscript.exe //x //d " + outFile, tsconfigFolder);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9hZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxxREFBcUQ7QUFDckQsMEVBQTBFO0FBQzFFLGdCQUFnQjtBQUNoQixxQ0FBcUM7QUFDckMsb0JBQW9CO0FBRXBCLElBQU0sR0FBRyxHQUFHLElBQUksYUFBYSxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFFNUQsSUFBTSxpQkFBaUIsR0FBRyxVQUFJLEdBQTBCO0lBQ3BELElBQU0sT0FBTyxHQUFRLEVBQUUsQ0FBQztJQUN4QixJQUFNLFVBQVUsR0FBRyxJQUFJLFVBQVUsQ0FBSSxHQUFHLENBQUMsQ0FBQztJQUMxQyxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDdkIsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtRQUN4QixPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQ2hDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztLQUN6QjtJQUNELE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQztBQUVGLElBQU0sY0FBYyxHQUFHLFVBQUMsQ0FBUyxJQUFLLE9BQUEsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBckIsQ0FBcUIsQ0FBQztBQU01RCxJQUFNLFNBQVMsR0FBRyxVQUFDLE9BQWUsRUFBRSxHQUFZLEVBQUUsTUFBZTtJQUM3RCxPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFlLE9BQVMsQ0FBQyxDQUFDO0lBQ3ZDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBVyxHQUFLLENBQUMsQ0FBQztJQUUvQixJQUFNLEtBQUssR0FBRyxJQUFJLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNqRCxJQUFJLEdBQUcsRUFBRTtRQUFFLEtBQUssQ0FBQyxnQkFBZ0IsR0FBRyxHQUFHLENBQUM7S0FBRTtJQUMxQyxJQUFNLElBQUksR0FBRyxLQUFL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LEdBQUcsR0FBcUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLGFBQWEsRUFBRSxlQUFlLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDMUgsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNwQixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDWixHQUFHLEdBQUcsU0FBUyxDQUFDO0FBRWhCLFNBQVMsQ0FBQywwQ0FBdUMsT0FBTyxPQUFHLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFFNUUsU0FBUyxDQUFDLHlCQUF1QixPQUFTLEVBQUUsY0FBYyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBjb25zdCBodG1sZmlsZSA9IFdTY3JpcHQuQ3JlYXRlT2JqZWN0KCdodG1sZmlsZScpO1xyXG4vLyBodG1sZmlsZS53cml0ZSgnPG1ldGEgaHR0cC1lcXVpdj1cIngtdWEtY29tcGF0aWJsZVwiIGNvbnRlbnQ9XCJJRT05XCIgLz4nKTtcclxuLy8gLy8gQHRzLWlnbm9yZVxyXG4vLyBKU09OID0gaHRtbGZpbGUucGFyZW50V2luZG93LkpTT047XHJcbi8vIGh0bWxmaWxlLmNsb3NlKCk7XHJcblxyXG5jb25zdCBmc28gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2NyaXB0aW5nLkZpbGVTeXN0ZW1PYmplY3QnKTtcclxuXHJcbmNvbnN0IGNvbGxlY3Rpb25Ub0FycmF5ID0gPFQ+KGNvbDogeyBJdGVtKGtleTogYW55KTogVCB9KTogVFtdID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdHM6IFRbXSA9IFtdO1xyXG4gICAgY29uc3QgZW51bWVyYXRvciA9IG5ldyBFbnVtZXJhdG9yPFQ+KGNvbCk7XHJcbiAgICBlbnVtZXJhdG9yLm1vdmVGaXJzdCgpO1xyXG4gICAgd2hpbGUgKCFlbnVtZXJhdG9yLmF0RW5kKCkpIHtcclxuICAgICAgICByZXN1bHRzLnB1c2goZW51bWVyYXRvci5pdGVtKCkpO1xyXG4gICAgICAgIGVudW1lcmF0b3IubW92ZU5leHQoKTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHRzO1xyXG59O1xyXG5cclxuY29uc3QgaXNBYnNvbHV0ZVBhdGggPSAoczogc3RyaW5nKSA9PiAvXltBLVphLXpdOi9pLnRlc3Qocyk7XHJcblxyXG5pbnRlcmZhY2UgU3RyZWFtIHtcclxuICAgIHN0ZG91dD86IHN0cmluZztcclxufVxyXG5cclxuY29uc3Qgc2hlbGxFeGVjID0gKGNvbW1hbmQ6IHN0cmluZywgY3dkPzogc3RyaW5nLCBzdHJlYW0/OiBTdHJlYW0pID0+IHtcclxuICAgIFdTY3JpcHQuRWNobyhgLS0gQ29tbWFuZDogJHtjb21tYW5kfWApO1xyXG4gICAgV1NjcmlwdC5FY2hvKGAtLSBDV0Q6ICR7Y3dkfWApO1xyXG5cclxuICAgIGNvbnN0IHNoZWxsID0gbmV3IEFjdGl2ZVhPYmplY3QoJ1dTY3JpcHQuU2hlbGwnKTtcclxuICAgIGlmIChjd2QpIHsgc2hlbGwuQ3VycmVudERpcmVjdG9yeSA9IGN3ZDsgfVxyXG4gICAgY29uc3QgZXhlYyA9IHNoZWxsLkV4ZWMoY29tbWFuZCk7XHJcbiAgICB3aGlsZSAoZXhlYy5TdGF0dXMgPT09IDApIHtcclxuICAgICAgICBXU2NyaXB0LlNsZWVwKDEwMCk7XHJcbiAgICAgICAgd2hpbGUgKCFleGVjLlN0ZE91dC5BdEVuZE9mU3RyZWFtKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRTdHJpbmcgPSBleGVjLlN0ZE91dC5SZWFkQWxsKCk7XHJcbiAgICAgICAgICAgIGlmIChzdHJlYW0pIHtcclxuICAgICAgICAgICAgICAgIHN0cmVhbS5zdGRvdXQgPSAoc3RyZWFtLnN0ZG91dCB8fCAnJykgKyBuZXh0U3RyaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFdTY3JpcHQuU3RkT3V0LldyaXRlKG5leHRTdHJpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGFyZ3MgPSBjb2xsZWN0aW9uVG9BcnJheShXU2NyaXB0LkFyZ3VtZW50cyk7XHJcbmlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBmaWxlIHRvIGNvbXBpbGUgYW5kIGRlYnVnJyk7XHJcbn1cclxuXHJcbmxldCBmaWxlID0gYXJnc1swXTtcclxuaWYgKCFpc0Fic29sdXRlUGF0aChmaWxlKSkge1xyXG4gICAgZmlsZSA9IGZzby5HZXRBYnNvbHV0ZVBhdGhOYW1lKGFyZ3NbMF0pOyAvLyBkZXBlbmRzIG9uIHRoZSBjdXJyZW50IHdvcmtpbmcgZm9sZGVyIGJlaW5nIHNldCBwcm9wZXJseVxyXG59XHJcbmlmICghZnNvLkZpbGVFeGlzdHMoZmlsZSkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZmluZCBmaWxlOiAke2FyZ3NbMF19IGF0IGxvY2F0aW9uICR7ZmlsZX1gKTtcclxufVxyXG5cclxubGV0IHRzY29uZmlnUGF0aCA9ICcnO1xyXG5sZXQgcGFyZW50ID0gZmlsZTtcclxuZG8ge1xyXG4gICAgcGFyZW50ID0gZnNvLkdldFBhcmVudEZvbGRlck5hbWUocGFyZW50KTtcclxuICAgIGNvbnN0IHRlc3RQYXRoID0gZnNvLkJ1aWxkUGF0aChwYXJlbnQsICd0c2NvbmZpZy5qc29uJyk7XHJcbiAgICBpZiAoZnNvLkZpbGVFeGlzdHModGVzdFBhdGgpKSB7XHJcbiAgICAgICAgdHNjb25maWdQYXRoID0gdGVzdFBhdGg7XHJcbiAgICB9XHJcbn0gd2hpbGUgKCF0c2NvbmZpZ1BhdGggJiYgcGFyZW50KTtcclxuXHJcbmlmICghdHNjb25maWdQYXRoKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byBmaW5kIHRzY29uZmlnLmpzb24gZm9yIGZpbGUgJyR7V1NjcmlwdC5TY3JpcHRGdWxsTmFtZX0nYCk7XHJcbn1cclxuXHJcbmNvbnN0IG91dGZvbGRlclBhdGggPSBmc28uQnVpbGRQYXRoKGZzby5HZXRQYXJlbnRGb2xkZXJOYW1lKFdTY3JpcHQuU2NyaXB0RnVsbE5hbWUpLCAnb3V0Jyk7XHJcbmlmIChmc28uRm9sZGVyRXhpc3RzKG91dGZvbGRlclBhdGgpKSB7XHJcbiAgICBmc28uRGVsZXRlRm9sZGVyKG91dGZvbGRlclBhdGgsIHRydWUpO1xyXG59XHJcbnRyeSB7XHJcbiAgICBmc28uQ3JlYXRlRm9sZGVyKG91dGZvbGRlclBhdGgpO1xyXG59IGNhdGNoIHtcclxuICAgIFdTY3JpcHQuU2xlZXAoMTAwKTtcclxuICAgIGZzby5DcmVhdGVGb2xkZXIob3V0Zm9sZGVyUGF0aCk7IC8vIHNvbWV0aW1lcyB3b3JrcyBvbiB0aGUgc2Vjb25kIGF0dGVtcHRcclxufVxyXG5cclxuY29uc3QgdHNjb25maWdGb2xkZXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZSh0c2NvbmZpZ1BhdGgpO1xyXG5jb25zdCBzdHJlYW06IFN0cmVhbSA9IHt9O1xyXG5zaGVsbEV4ZWMoJ3RzYy5jbWQgLS1ub0VtaXQgLS1saXN0RmlsZXMnLCB0c2NvbmZpZ0ZvbGRlciwgc3RyZWFtKTtcclxuaWYgKCEoc3RyZWFtLnN0ZG91dCkpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTm8gZW1pdHRlZCBmaWxlcycpO1xyXG59XHJcblxyXG5jb25zdCBzY3JpcHRGb2xkZXIgPSBmc28uR2V0UGFyZW50Rm9sZGVyTmFtZShXU2NyaXB0LlNjcmlwdEZ1bGxOYW1lKTtcclxuY29uc3Qgb3V0RmlsZSA9IGZzby5CdWlsZFBhdGgob3V0Zm9sZGVyUGF0aCwgZnNvLkdldEJhc2VOYW1lKGZpbGUpICsgJy5qcycpO1xyXG5jb25zdCBmaWxlcyA9IFtcclxuICAgIGZzby5CdWlsZFBhdGgoc2NyaXB0Rm9sZGVyLCAnbm9kZV9tb2R1bGVzXFxcXGVzNS1zaGltXFxcXGVzNS1zaGltLmpzJykucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKSxcclxuICAgIGZzby5CdWlsZFBhdGgoc2NyaXB0Rm9sZGVyLCAnbm9kZV9tb2R1bGVzXFxcXGFjdGl2ZXgtaGVscGVyc1xcXFxhY3RpdmV4LWpzLWhlbHBlcnMuanMnKS5yZXBsYWNlKC9cXFxcL2csICdcXFxcXFxcXCcpXHJcbl07XHJcbmZvciAodmFyIGlucHV0RmlsZSBvZiBzdHJlYW0uc3Rkb3V0LnNwbGl0KCdcXHJcXG4nKSkge1xyXG4gICAgaWYgKCFpbnB1dEZpbGUpIHsgY29udGludWU7IH1cclxuICAgIGlmIChpbnB1dEZpbGUuaW5kZXhPZignL0FwcERhdGEvUm9hbWluZy9ucG0vbm9kZV9tb2R1bGVzL3R5cGVzY3JpcHQvbGliLycpICE9PSAtMSkgeyBjb250aW51ZTsgfVxyXG4gICAgZmlsZXMucHVzaChpbnB1dEZpbGUucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKSk7XHJcbn1cclxuXHJcbmNvbnN0IHRzY29uZmlnID0gYHtcclxuICAgIFwiY29tcGlsZXJPcHRpb25zXCI6IHtcclxuICAgICAgICBcIm91dEZpbGVcIjogXCIke291dEZpbGUucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKX1cIixcclxuICAgICAgICBcImxpc3RFbWl0dGVkRmlsZXNcIjogdHJ1ZSxcclxuICAgICAgICBcIm5vRW1pdFwiOiBmYWxzZSxcclxuICAgICAgICBcIm1vZHVsZVwiOiBcInN5c3RlbVwiLFxyXG4gICAgICAgIFwiYWxsb3dKc1wiOiB0cnVlLFxyXG4gICAgICAgIFwiY2hlY2tKc1wiOiBmYWxzZSxcclxuICAgICAgICBcImlubGluZVNvdXJjZU1hcFwiOiB0cnVlLFxyXG4gICAgICAgIFwiaW5saW5lU291cmNlc1wiOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgXCJleHRlbmRzXCI6IFwiJHt0c2NvbmZpZ1BhdGgucmVwbGFjZSgvXFxcXC9nLCAnXFxcXFxcXFwnKX1cIixcclxuICAgIFwiZmlsZXNcIjogW1wiJHtmaWxlcy5qb2luKCdcIixcIicpfVwiXVxyXG59YDtcclxuXHJcbmxldCB0eHQ6IFNjcmlwdGluZy5UZXh0U3RyZWFtIHwgdW5kZWZpbmVkID0gZnNvLkNyZWF0ZVRleHRGaWxlKGZzby5CdWlsZFBhdGgob3V0Zm9sZGVyUGF0aCwgJ3RzY29uZmlnLmpzb24nKSwgdHJ1ZSwgdHJ1ZSk7XHJcbnR4dC5Xcml0ZSh0c2NvbmZpZyk7XHJcbnR4dC5DbG9zZSgpO1xyXG50eHQgPSB1bmRlZmluZWQ7XHJcblxyXG5zaGVsbEV4ZWMoYHRzYy5jbWQgLXAgdHNjb25maWcuanNvbiAtLW91dEZpbGUgXCIke291dEZpbGV9XCJgLCBvdXRmb2xkZXJQYXRoKTtcclxuXHJcbnNoZWxsRXhlYyhgY3NjcmlwdC5leGUgLy94IC8vZCAke291dEZpbGV9YCwgdHNjb25maWdGb2xkZXIpOyJdfQ==